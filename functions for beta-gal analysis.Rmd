---
title: "R Notebook"
output: html_notebook
---

This code imports, analyzes,and plots data from a single beta-galactosidase assay, as measured on our Bio-Tek plate reader.

Export the data from Gen5.

Leave Sheet 1 as it is.
On Sheet2, copy and paste the OD420 data (i.e. the beta-gal assay itself). Include the whole matrix, even though we won't use most of it in R.
Add seven more columns immediately to the right: experimenter, date, strain, RpoS, dilution factor, volume assayed, reaction time. (note the capitalization and spaces)

Fill in **each** cell in these seven columns:  

1. For **experimenter**, give your initials. Please be consistent and use the same initials as you use for strain names.
2. For **date**, please give them in format YYYY-MM-DD, ie "2018-06-07". This date should correspond to the date noted in your lab notebook when this experiment was done.
3. For **strain**, please use your personal strain number (I.e LB32, ANS138, etc...). Wells used as a blank should be called "blank".  
4. For **RpoS**, please give the % of wild-type in your condition, as determined by previous western blotting experiments. Wild-type = 100, knock-out = 0. Enter NA for wells used as a blank.  
5. For **dilutionFactor**, if you diluted your cells 1:n before adding them to the reaction/plate, give the value of n. (E.g. if you diluted your cells 1:100 before adding a volume to be assayed, enter 100 here.) Enter NA for wells used as a blank.
6. For **volumeAssayed**, give the volume you (possibly diluted) cells in mL you added to the tube when you assayed. This is usually 0.1 or 0.5. Enter NA for wells used as a blank.
7. For **reactionTime**, give the length of time the reaction proceeded before adding stop solution in minutes. Enter NA for wells used as a blank.

On Sheet3, copy and paste the OD600 data (i.e. the cell densities).
Add columns 1-5 above (experimenter, date, strain, RpoS, dilution factor) immediately to the right of the pasted data, with the exact same rules as above. The first four will be identical if you layed our your plate the same, but dilution factor will not. It is typically 10 for stationary phase cells.


Once you think you are done, *double-check everything*. Errors in data entry will mess everything else up.

To start the analysis, read in the data
```{r}
library(readxl)
fileName <- "6-6-18 LB32_LB73.xlsx" #Enter your file here. Remember that tab completion will help you get the path & name correct
OD420data <- read_excel(fileName, sheet = 2)
OD600data <- read_excel(fileName, sheet = 3)

View(OD420data)
View(OD600data)
```

# This code makes heavy use of tidyverse tools. FMI, I can't speak highly enough of the (free) book R for Data Science: http://r4ds.had.co.nz/

We're going to start by constructing a new data frame that has just the elements we need for our analysis 
```{r}
library(tidyverse)
theme_set(theme_classic())

meanCellDensities <-  filter(OD600data, strain != "blank") %>%
                  mutate(trueDensity = `Blank 600`*as.numeric(dilutionFactor)) %>%
                  group_by(strain, RpoS) %>% 
                  summarise(meanDensity = mean(trueDensity)) 
  

combinedData <-left_join(OD420data, meanCellDensities, by=c("strain", "RpoS")) %>%
                select(`Blank 420`, experimenter, date, strain, RpoS, dilutionFactor, volumeAssayed, reactionTime, meanDensity) %>%
                filter(strain != "blank") %>%
                rename(A420 = `Blank 420`) %>%
                type_convert() %>%
                mutate(`Miller Units` = 1000*A420*dilutionFactor/(meanDensity*volumeAssayed*reactionTime))

```


```{r}
ggplot(combinedData) + geom_point(aes(x=RpoS, y=`Miller Units`)) + facet_grid(.~strain)
ggplot(combinedData) + geom_point(aes(x=RpoS, y=`Miller Units`, color=strain))
```

Calculate and save the means at each concentration. 

These are the replciates we use for actual calcualations.

```{r}
expressionLevels <- group_by(combinedData, strain, RpoS, experimenter, date) %>% 
                      summarise(meanExpression = mean(`Miller Units`))
```


To gather together all of the individual data files to do a larger analysis:
```{r}

```

